# read in data
meta <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/meta.csv")
meta$hour=as.factor(meta$hour)
rownames(meta) <- meta$SampleID_merge
SAMP <- sample_data(meta)
sample_names(SAMP)<-meta$SampleID
peaks <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/peak.csv")
TAX <- tax_table(peaks) # gives a warning, don't freak out
taxa_names(TAX)<-peaks$Peak_ID
colnames(TAX)<- colnames(peaks)
abund <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/otu_ff_and_pa.csv", colClasses = c("factor","factor", rep("numeric", times= 58)))
# read in peak areas, assigning factors of diff classifications based on columns
rownames(abund) <- abund$Peak_ID #give abund rows names according to "Peak_ID" in peak.csv table
OTU <- otu_table(abund[,-c(1:2)], taxa_are_rows=T) #create a table with only peak areas, compounds are taxa
VOC <- phyloseq(OTU, TAX, SAMP) #IF YOU GET A "SAMPLE_NAMES()" ERROR MAKE SURE YOUR NAMES DO NOT START WITH A NUMBER
#returns: "phyloseq-class experiment-level object
#otu_table()   OTU Table:       [ 110 taxa and 24 samples ] "taxa" = VOCs "samples" = VOC pulls
#sample_data() Sample Data:     [ 24 samples by 8 sample variables ] "sample variable" = VOC jar
#tax_table()   Taxonomy Table:  [ 110 taxa by 2 taxonomic ranks ] "taxonomic rank" = microbe species"
p=plot_bar(VOC, "hour",fill="Peak_ID", facet_grid = ~microbe)
p + geom_point(aes(x=microbe, y=Abundance), color="black", size=3)
###############################
# Analysis and figures
##############################
##############
#    PCoAs   #
##############
###	#PCoA with Bray-Curtis Distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
names(new.dat)[15:17] <- c("microbe","juice","hour") #for the "must be the same length as vector" error make sure that the info inside the bracets matches empty columns in the dataframe your creating"
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$hour, new.order = c("2","24","48"))
summary(new.dat)
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (65.6% Var. Expl.)")+ 	## !don't forget to update these moving forward!
ylab("PCoA2 (21.2% Var. Expl.)")
###	#PCoA with Bray-Curtis Distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
View(new.dat)
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
names(new.dat)[32:34] <- c("microbe","juice","hour") #for the "must be the same length as vector" error make sure that the info inside the bracets matches empty columns in the dataframe your creating"
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$hour, new.order = c("2","24","48"))
summary(new.dat)
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (65.6% Var. Expl.)")+ 	## !don't forget to update these moving forward!
ylab("PCoA2 (21.2% Var. Expl.)")
###	#PCoA with Jaccard distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "jaccard")
plot_ordination( VOC, ord, color = "hour", shape = "microbe", type = "samples")
# split plot of compounds driving separation and samples in PC1/PC2.
plot_ordination(VOC, ord, type = "samples", color = "hour", shape = "microbe", label = "rep")
###
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$hour, sample_data(VOC)$rep) # make a new matrix
View(new.dat)
###############################
# Analysis and figures
##############################
##############
#    PCoAs   #
##############
###	#PCoA with Bray-Curtis Distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
names(new.dat)[32:34] <- c("microbe","juice","hour") #for the "must be the same length as vector" error make sure that the info inside the bracets matches empty columns in the dataframe your creating"
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$hour, new.order = c("2","24","48"))
summary(new.dat)
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (65.6% Var. Expl.)")+ 	## !don't forget to update these moving forward!
ylab("PCoA2 (21.2% Var. Expl.)")
###	#PCoA with Jaccard distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "jaccard")
plot_ordination( VOC, ord, color = "hour", shape = "microbe", type = "samples")
# split plot of compounds driving separation and samples in PC1/PC2.
plot_ordination(VOC, ord, type = "samples", color = "hour", shape = "microbe", label = "rep")
###
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$hour, sample_data(VOC)$rep) # make a new matrix
names(new.dat)[38:40] <- c("Microbe", "Hour", "Rep")
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$Microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$Hour, new.order = c("2","24", "48"))
###
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (54.6% Var. Expl.)")+
ylab("PCoA2 (21.5% Var. Expl.)")
sample_data(VOC)$fday <- factor(sample_data(VOC)$hour)
sample_data(VOC)$fmicrobe <- factor(sample_data(VOC)$microbe)
sample_data(VOC)$fnectar <- factor(sample_data(VOC)$rep)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar+ sample_data(VOC)$fday+
+ sample_data(VOC)$fmicrobe)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar * sample_data(VOC)$fday * sample_data(VOC)$fmicrobe)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$nectar.conc+ sample_data(VOC)$fday+
+ sample_data(VOC)$microbe.treatment)
summary(fit)
sample_data(VOC)$fday <- factor(sample_data(VOC)$hour)
sample_data(VOC)$fmicrobe <- factor(sample_data(VOC)$microbe)
sample_data(VOC)$fnectar <- factor(sample_data(VOC)$rep)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar+ sample_data(VOC)$fday+
+ sample_data(VOC)$fmicrobe)
summary(fit)
sample_data(VOC)$fday <- factor(sample_data(VOC)$hour)
sample_data(VOC)$fmicrobe <- factor(sample_data(VOC)$microbe)
sample_data(VOC)$fnectar <- factor(sample_data(VOC)$rep)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar+ sample_data(VOC)$fday+
+ sample_data(VOC)$fmicrobe)
summary(fit)
# same results
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar * sample_data(VOC)$fday * sample_data(VOC)$fmicrobe)
summary(fit)
sample_data(VOC)$fday <- factor(sample_data(VOC)$hour)
sample_data(VOC)$fmicrobe <- factor(sample_data(VOC)$microbe)
sample_data(VOC)$fnectar <- factor(sample_data(VOC)$rep)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar+ sample_data(VOC)$fday+
+ sample_data(VOC)$fmicrobe)
summary(fit)
# same results
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar * sample_data(VOC)$fday * sample_data(VOC)$fmicrobe)
summary(fit)
sample_data(VOC)$fday <- factor(sample_data(VOC)$hour)
sample_data(VOC)$fmicrobe <- factor(sample_data(VOC)$microbe)
sample_data(VOC)$fnectar <- factor(sample_data(VOC)$rep)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar+ sample_data(VOC)$fday+
+ sample_data(VOC)$fmicrobe)
summary(fit)
# same results
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$fnectar * sample_data(VOC)$fday * sample_data(VOC)$fmicrobe)
summary(fit)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$rep+ sample_data(VOC)$fday+
+ sample_data(VOC)$microbe)
anova(fit)
TukeyHSD(aov(fit), which="sample_data(VOC)$microbe")
TukeyHSD(aov(fit), which="sample_data(VOC)$rep")
TukeyHSD(aov(fit), which="sample_data(VOC)$fday")
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$rep* sample_data(VOC)$fday
* sample_data(VOC)$microbe)
summary(fit)
aov(fit)
fit <- lm(sample_sums(VOC)~ sample_data(VOC)$rep* sample_data(VOC)$fday
* sample_data(VOC)$microbe)
aov(fit)
TukeyHSD(aov(fit), which="sample_data(VOC)$fday")
TukeyHSD(aov(fit), which="sample_data(VOC)$rep")
TukeyHSD(aov(fit), which="sample_data(VOC)$microbe")
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[4] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[8] <- c("Day")
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = distance(VOC, "bray") # make a dissimilarity matrix named d
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[4] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[8] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("PA", "FF"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("Process", "Blank", "Treat"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
View(abund)
View(meta)
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[4] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[8] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("Process", "Blank", "Treat"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[4] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[8] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
View(df)
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[4] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[8] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
df$Day <- reorder.factor(df$Day, new.order = c("02", "24", "48"))
df$Day <- reorder.factor(df$hour, new.order = c("02", "24", "48"))
df$Day <- reorder.factor(df$fday, new.order = c("02", "24", "48"))
df$Day <- reorder.factor(df$Day, new.order = c("02", "24", "48"))
names(df)[2] <- c("Microbe")
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[9] <- c("Microbe")
names(df)[10] <- c("Nectar")
names(df)[11] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[4] <- c("Nectar")
names(df)[6] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
names(df)[5] <- c("Nectar")
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[5] <- c("Nectar")
names(df)[3] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
#############
# PERMANOVA #
#############
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[5] <- c("Nectar")
names(df)[4] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "bray") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[4] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
b_test <-betadisper(d, group=df$Microbe, type="median")
b_test
TukeyHSD(b_test)
fit = adonis(d ~ Nectar + Day + Microbe, df)
summary(fit)
fit = adonis(d ~ Nectar + Day + Microbe, df)
summary(fit)
df = as(sample_data(VOC), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(VOC, "jaccard") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[4] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
b_test <-betadisper(d, group=df$Microbe, type="median")
b_test
TukeyHSD(b_test)
b_test <-betadisper(d, group=df$Nectar, type="median")
b_test
TukeyHSD(b_test)
fit
Mrsonly <- subset_samples(VOC, microbe!="FF")
df = as(sample_data(Mrsonly), "data.frame") # coerce to a data frame named df
d = distance(Mrsonly, "bray") # make a dissimilarity matrix named d
d = phyloseq::distance(Mrsonly, "bray") # make a dissimilarity matrix named d
Mrsonly <- subset_samples(VOC, microbe!="FF")
df = as(sample_data(Mrsonly), "data.frame") # coerce to a data frame named df
d = phyloseq::distance(Mrsonly, "bray") # make a dissimilarity matrix named d
names(df)[2] <- c("Microbe")
names(df)[6] <- c("Nectar")
names(df)[4] <- c("Day")
library(gdata)
df$Microbe <- reorder.factor(df$Microbe, new.order = c("FF", "PA"))
df$Nectar <- reorder.factor(df$Nectar, new.order = c("B01", "B02", "B03", "P01", "P02", "P03", "R01", "R02", "R03", "R04"))
df$Day <- reorder.factor(df$Day, new.order = c("2", "24", "48"))
fit = adonis(d ~ Nectar * Day * Microbe, df)
abund <- round(abund[,-c(1:2)], digits = 0)
OTU <- otu_table(abund, taxa_are_rows=T)
VOC <- phyloseq(OTU, TAX, SAMP)
VOC
plot_richness(VOC, x = "microbe", measures = c("Observed", "Shannon", "Simpson"))
View(VOC)
View(abund)
abund <- round(abund[,-c(1:2)], digits = 0)
OTU <- otu_table(abund, taxa_are_rows=T)
VOC <- phyloseq(OTU, TAX, SAMP)
VOC
plot_richness(VOC, x = "microbe", measures = c("Observed", "Shannon", "Simpson"))
plot_richness(VOC, x = "rep", measures = c("Observed", "Shannon", "Simpson"))
View(abund)
abund <- round(abund[,-c(1:2)], digits = 0)
OTU <- otu_table(abund, taxa_are_rows=T)
View(abund)
library(gdata)
library(devtools)
library(ggplot2)
library(beeswarm)
library(phyloseq) #install via bioconductor
library(vegan)
library(ggbiplot)
library(readxl)
library(readr)
library(ape)
# read in data
meta <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/meta.csv")
meta$hour=as.factor(meta$hour)
rownames(meta) <- meta$SampleID_merge
SAMP <- sample_data(meta)
sample_names(SAMP)<-meta$SampleID
peaks <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/peak.csv")
TAX <- tax_table(peaks) # gives a warning, don't freak out
taxa_names(TAX)<-peaks$Peak_ID
colnames(TAX)<- colnames(peaks)
abund <- read.csv("~/GitHub/BACandBlue/data/BACandBLUE_SUBSET_FFvsPA_10BB_PROvsREP/otu_ff_and_pa.csv", colClasses = c("factor","factor", rep("numeric", times= 58)))
# read in peak areas, assigning factors of diff classifications based on columns
rownames(abund) <- abund$Peak_ID #give abund rows names according to "Peak_ID" in peak.csv table
OTU <- otu_table(abund[,-c(1:2)], taxa_are_rows=T) #create a table with only peak areas, compounds are taxa
VOC <- phyloseq(OTU, TAX, SAMP) #IF YOU GET A "SAMPLE_NAMES()" ERROR MAKE SURE YOUR NAMES DO NOT START WITH A NUMBER
#returns: "phyloseq-class experiment-level object
#otu_table()   OTU Table:       [ 110 taxa and 24 samples ] "taxa" = VOCs "samples" = VOC pulls
#sample_data() Sample Data:     [ 24 samples by 8 sample variables ] "sample variable" = VOC jar
#tax_table()   Taxonomy Table:  [ 110 taxa by 2 taxonomic ranks ] "taxonomic rank" = microbe species"
p=plot_bar(VOC, "hour",fill="Peak_ID", facet_grid = ~microbe)
p + geom_point(aes(x=microbe, y=Abundance), color="black", size=3)
###############################
# Analysis and figures
##############################
##############
#    PCoAs   #
##############
###	#PCoA with Bray-Curtis Distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
names(new.dat)[32:34] <- c("microbe","juice","hour") #for the "must be the same length as vector" error make sure that the info inside the bracets matches empty columns in the dataframe your creating"
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$hour, new.order = c("2","24","48"))
summary(new.dat)
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (65.6% Var. Expl.)")+ 	## !don't forget to update these moving forward!
ylab("PCoA2 (21.2% Var. Expl.)")
###	#PCoA with Jaccard distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "jaccard")
plot_ordination( VOC, ord, color = "hour", shape = "microbe", type = "samples")
# split plot of compounds driving separation and samples in PC1/PC2.
plot_ordination(VOC, ord, type = "samples", color = "hour", shape = "microbe", label = "rep")
###
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$hour, sample_data(VOC)$rep) # make a new matrix
names(new.dat)[38:40] <- c("Microbe", "Hour", "Rep")
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$Microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$Hour, new.order = c("2","24", "48"))
###
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (54.6% Var. Expl.)")+
ylab("PCoA2 (21.5% Var. Expl.)")
ord <- ordinate(VOC, method = "PCoA", distance = "jaccard")
plot_ordination( VOC, ord, color = "hour", shape = "microbe", type = "samples")
# split plot of compounds driving separation and samples in PC1/PC2.
plot_ordination(VOC, ord, type = "samples", color = "hour", shape = "microbe", label = "rep")
###
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$hour, sample_data(VOC)$rep) # make a new matrix
View(new.dat)
###############################
# Analysis and figures
##############################
##############
#    PCoAs   #
##############
###	#PCoA with Bray-Curtis Distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "bray")
plot_ordination(VOC, ord, color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
plot_ordination(VOC, ord, type = "juice", color = "hour", shape = "microbe", label = "rep")+
theme_bw() + theme(text = element_text(size = 20)) + geom_point(size = 4)
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$rep, sample_data(VOC)$hour) # make a new matrix
names(new.dat)[32:34] <- c("microbe","juice","hour") #for the "must be the same length as vector" error make sure that the info inside the bracets matches empty columns in the dataframe your creating"
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$hour, new.order = c("2","24","48"))
summary(new.dat)
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (65.6% Var. Expl.)")+ 	## !don't forget to update these moving forward!
ylab("PCoA2 (21.2% Var. Expl.)")
###	#PCoA with Jaccard distances#	###
ord <- ordinate(VOC, method = "PCoA", distance = "jaccard")
plot_ordination( VOC, ord, color = "hour", shape = "microbe", type = "samples")
# split plot of compounds driving separation and samples in PC1/PC2.
plot_ordination(VOC, ord, type = "samples", color = "hour", shape = "microbe", label = "rep")
###
PCs <- data.frame(scores(ord$vectors))
new.dat <- cbind(PCs, sample_data(VOC)$microbe, sample_data(VOC)$hour, sample_data(VOC)$rep) # make a new matrix
names(new.dat)[39:41] <- c("Microbe", "Hour", "Rep")
library(gdata)
new.dat$Microbe <- reorder.factor(new.dat$Microbe, new.order = c("FF", "PA"))
new.dat$Hour <- reorder.factor(new.dat$Hour, new.order = c("2","24", "48"))
###
ggplot(new.dat, aes(x=Axis.1, y= Axis.2)) +
geom_point(aes(color = Microbe, shape = Hour), position ="jitter") +
facet_grid(~Hour)+
theme_bw()+
xlab("PCoA1 (54.6% Var. Expl.)")+
ylab("PCoA2 (21.5% Var. Expl.)")
abund <- round(abund[,-c(1:2)], digits = 0)
OTU <- otu_table(abund, taxa_are_rows=T)
VOC <- phyloseq(OTU, TAX, SAMP)
VOC
plot_richness(VOC, x = "microbe", measures = c("Observed", "Shannon", "Simpson"))
plot_richness(VOC, x = "rep", measures = c("Observed", "Shannon", "Simpson"))
fit <- lm(estimate_richness(VOC)$Shannon ~ sample_data(VOC)$microbe)
anova(fit)
fit <- lm(estimate_richness(VOC)$Observed ~ sample_data(VOC)$microbe)
fit
fit <- lm(estimate_richness(VOC)$Simpson ~ sample_data(VOC)$microbe)
fit
fit <- lm(estimate_richness(VOC)$Simpson ~ sample_data(VOC)$microbe)
fit
fit <- lm(estimate_richness(VOC)$Shannon ~ sample_data(VOC)$rep)
fit
fit <- lm(estimate_richness(VOC)$Observed ~ sample_data(VOC)$rep)
fit
fit <- lm(estimate_richness(VOC)$Simpson ~ sample_data(VOC)$rep)
fit
NoZero <- subset_samples(VOC, day!="2")
NoZero <- subset_samples(VOC, hour!="2")
plot_richness(NoZero, x = "microbe", measures = c("Observed", "Shannon", "Simpson"))
plot_richness(NoZero, x = "rep", measures = c("Observed", "Shannon", "Simpson"))
fit <- lm(estimate_richness(NoZero)$Shannon ~ sample_data(NoZero)$microbe)
fit
fit <- lm(estimate_richness(NoZero)$Observed ~ sample_data(NoZero)$microbe)
fit
fit <- lm(estimate_richness(NoZero)$Simpson ~ sample_data(NoZero)$microbe)
fit
library("DESeq2")
NoZero <- subset_samples(VOC, hour!="2")
deobj <- phyloseq_to_deseq2(NoZero, ~ rep + microbe)
diagdds = DESeq(deobj, test="Wald", fitType="local")
res = results(diagdds, contrast = c("microbe", "FF", "PA"), cooksCutoff = FALSE)
#NoZero <- subset_samples(VOC, hour!="2")
deobj <- phyloseq_to_deseq2(VOC, ~ rep + microbe)
diagdds = DESeq(deobj, test="Wald", fitType="local")
res = results(diagdds, contrast = c("microbe", "FF", "PA"), cooksCutoff = FALSE)
